<html layout:decorate="~{admin}">
<div layout:fragment="content">

    <h4>관리자용 메뉴</h4>

    <div class="container d-flex">
        <div class="nav-container">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="/admin/userconfig">사용자 관리</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/festivalconfig">축제 게시물 관리</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" aria-disabled="true">Disabled</a>
                </li>
            </ul>
        </div>

        <div class="chart-container" style="flex-grow: 1; padding-left: 20px; min-height: 400px; min-width: 400px;">
            <canvas id="myChart"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script >
        const ctx = document.getElementById('myChart');

        // 타임리프를 통해 총 방문자 수를 가져오고, 데이터가 없으면 기본값 0을 설정
 	const totalVisitorCount = [[${visitorCount}]] || 0;

        // 최근 1주일의 날짜 생성
        const labels = [];
        const today = new Date();
        for (let i = 6; i >= 0; i--) {
            const date = new Date(today);
            date.setDate(today.getDate() - i);
            labels.push(date.toLocaleDateString()); // YYYY/MM/DD 형식으로 변환
        }

        // 타임리프를 통해 일일 방문자 데이터를 가져오고, 데이터가 없으면 기본값 설정
    const dailyVisitorCounts = [[${dailyVisitorCounts}]] || [0, 0, 0, 0, 0, 0, 0];

        // 디버깅을 위한 콘솔 출력
        console.log("Total Visitor Count:", totalVisitorCount);
        console.log("Daily Visitor Counts:", dailyVisitorCounts);

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels, // x축: 날짜
                datasets: [{
                    label: '일일 방문자 수',
                    data: dailyVisitorCounts, // y축: 일일 방문자 수
                    borderWidth: 1,
                    backgroundColor: 'rgba(15, 59, 66, 1)',
                    borderColor: 'rgba(12, 47, 53, 1)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: '총 방문자 수: ' + totalVisitorCount // 그래프 제목에 총 방문자 수 추가
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>

</div>
</html>
