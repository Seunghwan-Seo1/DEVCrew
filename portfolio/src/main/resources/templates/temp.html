<html layout:decorate="~{admin}">
<div layout:fragment="content">

<div class="chat-container">
    <div class="messages" id="messages"></div>
    <input type="text" id="userInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    const messagesDiv = document.getElementById('messages');

    function sendMessage() {
        const userInput = document.getElementById('userInput').value;
        if (userInput) {
            addMessage(userInput, 'user');

            // 서버에 질문을 보냄
            askQuestion(userInput).then(response => {
                addMessage(response, 'bot');
            });

            document.getElementById('userInput').value = ''; // 입력란 비우기
        }
    }

    function addMessage(message, sender) {
        const newMessageDiv = document.createElement('div');
        newMessageDiv.className = sender;
        newMessageDiv.textContent = message;
        messagesDiv.appendChild(newMessageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // 자동 스크롤
    }

    async function askQuestion(question) {
        try {
            const response = await fetch('http://localhost:3306/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ question }),
            });

            const data = await response.json();
            return data.response;
        } catch (error) {
            console.error('Error:', error);
            return "Sorry, something went wrong.";
        }
    }
</script>

</html>