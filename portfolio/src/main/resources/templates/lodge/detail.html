<html layout:decorate="~{layout}">

<div layout:fragment="content">

<!-- 	<link rel="apple-touch-icon" type="image/png"
		href="https://cpwebassets.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png" />
	<meta name="apple-mobile-web-app-title" content="CodePen">
	<link rel="shortcut icon" type="image/x-icon"
		href="https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico" />
	<link rel="mask-icon" type="image/x-icon"
		href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg"
		color="#111" />
	<script
		src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-2c7831bb44f98c1391d6a4ffda0e1fd302503391ca806e7fcc7b9b87197aec26.js"></script>
	<link rel="canonical" href="https://codepen.io/8happyhee/pen/KKBEEXQ">
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"> -->



<style>
a {
	text-decoration: none;
	color: inherit;
}

.tab {
	display: flex;
	align-items: center;
	padding: 1rem;
	list-style-type: none;
}

.tab__item {
	padding: 0.6rem 1.3rem;
	margin-right: 1rem;
	border: 1px solid #ddd;
	border-radius: 2rem;
	cursor: pointer;
}

.tab__item.active {
  display: inline-block;
  border: 1px solid #83a4ff;
  background-color: #83a4ff;
  color: #fff;
}

.tab__content-wrapper {
	padding: 1rem;
}

.tab__content {
	display: none;
}

.tab__content.active {
	display: block;
}

.untree_co-section {
	display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;	
}

.detailcontainer {
 	 display: grid;
/* 	 grid-template-columns: 2fr 1fr 1fr;
	 grid-template-rows: 1fr 1fr; */
	 /* width: 80%;
	 height: 80vh; */
}

/* .block 1strow {
	grid-column: 1 / 2;
    grid-row: 1 / 3;
} */

.firstin {
	grid-column: 1 / 2;
    grid-row: 1 / 3;
}

.secondin {
	grid-column: 3 / 4;
    grid-row: 1 / 2;
}

.accommlocation {
	grid-column: 2 / 4;
    grid-row: 2 / 3;
}

.block {
      display: flex;
     /*  justify-content: center;
      align-items: center; */
}

#linfo, #review, #notice {
	border : 2px solid  #83a4ff;
}

#message2 {
	border: 1px solid #83a4ff;
	padding: 10px;
	margin-bottom: 10px;
}
#rvCmt {
 	border: 1px solid gray;
	margin : 5px;
	padding : 10px;
 }

textarea {
resize: none;
}

.comments-list {
	margin-bottom : 10px;
	padding : 10px;
}
.twobtn {
	float : right;
	display: inline-block;    
    align-self: flex-end;
}

.review-actions {
	float : right;
	text-align : center;
	display: inline-block;
    align-self: flex-end; 
}

.edit-btn, .delete-btn {
	border: 1px solid #83a4ff;
    background-color: #83a4ff;
    color: #fff;
    display: inline-block;
    align-self: flex-end;
    justify-content: space-between;

}

</style>

<div class="hero hero-inner">
	<div class="container">
		<div class="row align-items-center">
			<div class="col-lg-6 mx-auto text-center">
				<div class="intro-wrap">

					<h1 class="mb-0">나에게 맞는 숙소 찾기</h1>

					<p class="text-white">축제와 가깝고 편한 숙소를 소개합니다</p>
				</div>
			</div>
		</div>
	</div>
</div>


	<div class="container">
		<div class="row">
			<div class="col-md-6">
				<div class="filter-container"></div>
			</div>
		</div>
	</div>  


<!-- 숙소 사진, 지도 -->
<div class="untree_co-section">
	<div class="detailcontainer">
		<div class="col-md-10">
			<div> <!-- col-lg-6 mb-5 mb-lg-0 -->
				<form class="contact-form" data-aos="fade-up" data-aos-delay="200">
					<div class="block 1strow">
					<img th:src="@{|${downpath}/${lodge.accomm}|}" width="400px" height="400px">					
					</div>
				</form>
			</div>

		</div>
		<div class="col-md-6 d-flex flex-column justify-content-center"> <!-- col-lg-12 ml-auto -->
			<div class="block firstin">
				<form><img th:src="@{|${downpath}/${lodge.firstaccomm}|}" width="300px" height="250px"></form>
			</div>			
		</div>			
		<div class="block secondin">
			<form><img th:src="@{|${downpath}/${lodge.secondaccomm}|}" width="300px" height="250px"></form>
		</div>
		<div class="block accommlocation">	
			<form>지도 위치</form>
		</div>
		
	</div>
</div>

<!-- 하단 옵션 -->
<div class="album py-5">
	<div class="container">
		<div class="container2">
			<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3"></div>

			<ul class="tab">
				<li class="tab__item active" id="linfo">숙소 소개</li>
				<li class="tab__item" id="review">리뷰보기</li>
				<li class="tab__item" id="notice">안내 사항</li>
			</ul>
			
<!-- 탭 내용 영역 -->
	<div class="tab__content-wrapper">
		<div id="linfo" class="tab__content active">
		
		 <div class="mt-2.5">
	     	<div id="message" rows="4" class="block w-full rounded-md border-0 px-3.5 py-2 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
	     	
	     	<a th:utext=${lodge.linfo}></a>
	     	
	     	</div>
	    </div>
	    </div>
	
	
		<div id="review" class="tab__content">


    <div id="rvCmt" class="row_txtArea">   
	<form th:action="@{|/review/rvcreate/${lodge.lnum}|}"method="post"> 
            <label for="comment">작성 글자 제한</label>
            <span class="ipt_msg txtLen" id="ipt_msg_txtLen"><strong>0</strong>/200</span>
            <textarea id="comment" name="rcontent" autocomplete="off" placeholder="숙소 후기를 적어주세요" style="width:100%; height:100%;" minlength="5" maxlength="1000"></textarea>          
        <input type="submit" value="리뷰등록">
    </form>
    </div>


<div class="my-3 p-3 bg-white" style="padding-top: 10px">
<p style="font-size:20px;">등록된 리뷰 보기<p>



<div id="comments-list">

	<th:block th:each="review : ${lodge.reviewList}">
  
  
  		 <div class="mt-2.5">
 			<div id="message2" rows="4" class="block w-full rounded-md border-1 px-3.5 py-2 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
 						
			[[${review.rnum}]]번째 댓글<br>
			작성자 : [[${review.username}]]<br>
			리뷰 : [[${review.rcontent}]]<br>
			

 			
 			     <div class="review-actions">              
				
   
                     <!--  작성자 일 때만 버튼이 보이도록 설정 -->
<th:block th:if="${#authentication.name == review.username}">     
        
<a th:href="@{|/review/delete/${review.rnum}|}" class="btn btn-danger">삭제</a>
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  
</button>

</th:block>



<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
<form action="/review/rvtest" method="post">
      <input type="hidden" name="lid" th:value="${lodge.lnum}">
      <input type="hidden" name="rnum" th:value="${review.rnum}">
      
      <input type="text" name="rcontent" th:value="${review.rcontent}">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
        <input type="submit" class="btn btn-danger">수정</a> 
      </div>
</form>
    </div>
  </div>
</div>






                     
                     
                     
                     

					
                 </div>
                
                
 		<div class="twobtn">
            <a href="javascript:void(0);"class="agree btn-two green mini" th:data-uri="@{|/review/ragree/${review.ragree}|}">
                공감
                <span class="badge rounded-pill bg-success" th:text="${#lists.size(review.ragree)}"></span>
            </a>
            <a href="javascript:void(0);" class="disagree btn-two red mini" th:data-uri="@{|/review/rdisagree/${review.rdisagree}|}">
                비공감
                <span class="badge rounded-pill bg-danger" th:text="${#lists.size(review.rdisagree)}"></span>
            </a>
        </div>
        
 			</div>
		</div>
		
	</th:block>
	

</div> 
</div>


</div>



	<div id="notice" class="tab__content">
	
		 <div class="mt-2.5">
 			<div id="message" rows="4" class="block w-full rounded-md border-0 px-3.5 py-2 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">[[${lodge.notice}]]</div>
		</div>
    </div>
</div>




</div>
</div>

</div>
</div>



<script id="rendered-js">
// 1. 탭 버튼과 탭 내용 부분들을 querySelectorAll을 사용해 변수에 담는다.
const tabItem = document.querySelectorAll(".tab__item");
const tabContent = document.querySelectorAll(".tab__content");

// 2. 탭 버튼들을 forEach 문을 통해 한번씩 순회한다.
// 이때 index도 같이 가져온다.
tabItem.forEach((item, index) => {
  // 3. 탭 버튼에 클릭 이벤트를 준다.
  item.addEventListener("click", e => {
    // 4. 버튼을 a 태그에 만들었기 때문에, 
    // 태그의 기본 동작(링크 연결) 방지를 위해 preventDefault를 추가한다.
    e.preventDefault(); // a 

    // 5. 탭 내용 부분들을 forEach 문을 통해 한번씩 순회한다.
    tabContent.forEach(content => {
      // 6. 탭 내용 부분들 전부 active 클래스를 제거한다.
      content.classList.remove("active");
    });

    // 7. 탭 버튼들을 forEach 문을 통해 한번씩 순회한다.
    tabItem.forEach(content => {
      // 8. 탭 버튼들 전부 active 클래스를 제거한다.
      content.classList.remove("active");
    });

    // 9. 탭 버튼과 탭 내용 영역의 index에 해당하는 부분에 active 클래스를 추가한다.
    // ex) 만약 첫번째 탭(index 0)을 클릭했다면, 같은 인덱스에 있는 첫번째 탭 내용 영역에 active 클래스가 추가된다.
    tabItem[index].classList.add("active");
    tabContent[index].classList.add("active");
  });
});
</script>

<script>
//글자수 세는 기능
$('.row_txtArea textarea').keyup(function(){
	  var content = $(this).val();
	  $('.row_txtArea .ipt_msg txtLen span').html(rcontent.length);
	  if (rcontent.length > 200){
	    alert("최대 200자까지 입력 가능합니다.");
	    $(this).val(rcontent.substring(0, 200));
	    $('.row_txtArea .ipt_msg txtLen span').html(200);
	  }
	});
	
	
//버튼 기능
document.querySelectorAll('.edit-btn').forEach(button => {
     button.addEventListener('click', function() {
         const rvId = this.getAttribute('data-review-rum');
         const rnum = document.querySelector('input[name="rnum"]').value; 
         editReview(rvId, rnum);
     });
 });

 document.querySelectorAll('.delete-btn').forEach(button => {
     button.addEventListener('click', function() {
         const rvId = this.getAttribute('data-review-rum');
         const rnum = document.querySelector('input[name="rnum"]').value; 
         deleteReview(rvId, rnum);
     });
 });

 function editReview(rvId, rnum) {
     const reviewContent = document.querySelector(`[data-review-id="${rvId}"]`).parentElement.previousElementSibling.innerText;
     const newContent = prompt("작성한 리뷰를 수정하세요:", reviewContent);

     if (newContent !== null) {
         updateReview(rvId, newContent, rnum);
     }
 }

 function updateReview(rvId, newContent, rnum) {
     const form = document.createElement('form');
     form.method = 'POST';
     form.action = `/review/detail/rvupdate/${rvId}`;

     const inputContent = document.createElement('input');
     inputContent.type = 'hidden';
     inputContent.name = 'rcontent';
     inputContent.value = newContent;
     form.appendChild(inputContent);

     const inputRnum = document.createElement('input');
     inputRnum.type = 'hidden';
     inputRnum.name = 'rnum';
     inputRnum.value = rnum;  
     form.appendChild(inputRnum);

     const csrfInput = document.createElement('input');
     csrfInput.type = 'hidden';
     csrfInput.name = '${_csrf.parameterName}';
     csrfInput.value = '${_csrf.token}';
     form.appendChild(csrfInput);

     document.body.appendChild(form);
     form.submit();
 }

 function deleteReview(reviewId, rnum) {
     if (confirm('정말로 이 리뷰를 삭제하시겠습니까?')) {
         const form = document.createElement('form');
         form.method = 'POST';
         form.action = `/review/delete/${mid}`;

         const csrfInput = document.createElement('input');
         csrfInput.type = 'hidden';
         csrfInput.name = '${_csrf.parameterName}';
         csrfInput.value = '${_csrf.token}';
         form.appendChild(csrfInput);
         
         const inputRnum = document.createElement('input');
         inputRnum.type = 'hidden';
         inputRnum.name = 'rnum';
         inputRnum.value = rnum;  
         form.appendChild(inputRnum);

         document.body.appendChild(form);
         form.submit();
     }
 }

const agree_elements = document.getElementsByClassName("ragree");
Array.from(agree_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("해당 리뷰에 공감하시나요?")) {
            location.href = this.dataset.uri;
        }
    });
});

const disagree_elements = document.getElementsByClassName("rdisagree");
Array.from(disagree_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("해당 리뷰에 비공감하시나요?")) {
            location.href = this.dataset.uri;
        }
    });
});

</script>

</body>
</html>